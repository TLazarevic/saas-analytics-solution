extends layout

block head
  link(rel="stylesheet" href="/stylesheets/board.css")
  script(src = "/public/javascripts/boards.js", type = "module")
  script(src='https://code.jquery.com/jquery-3.7.1.min.js')
  script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js')
  script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js")
  script.
    window.boardId = "#{board.id}";
block content
  body
    include navbar.pug
    h1.board-name #{board.name}
    div.content
      div.grid.flex-start-content.board
        div.grid.flex-start-content.flex-div.sortable_column
          each column in board.columns
            div.column.sortColumn(id=`${column.id}`)
              div.sortable_card(id=`${column.id}`)
                p.column_header #{column.name}
                each card in column.cards
                  div.sortCard.cards(id=`${card.id}` data-bs-toggle='modal' role="button" data-bs-target=`#cardDetailModal_${card.id}`)
                    .title-container
                      div #{card.name}
                      div.priority-dot
                        - var priorityColor = card.priority === 'high' ? '#f88fa9' : card.priority === 'medium' ? '#ffffd3' : '#6fadc7'
                        span(style=`color: ${priorityColor}; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);`) •
                  .modal.hide.fade(tabindex='-1' aria-labelledby='cardDetailModalLabel' aria-hidden='true' id=`cardDetailModal_${card.id}`)
                    .modal-dialog.modal-md
                      .modal-content
                        .modal-header
                          h4#cardDetailModalLabel.modal-title 
                            - var priorityColor = card.priority === 'high' ? '#f88fa9' : card.priority === 'medium' ? '#ffffd3' : '#6fadc7'
                            span(style=`color: ${priorityColor}; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);`) •
                            | #{card.name}
                          button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close')
                        .modal-body
                          form.card-details-form.form-horizontal
                            .form-group
                              .row.mb-3
                                label.form-label.col-sm-3.col-form-label.mb-2.fw-bold Description
                                p #{card.description}
                                label.form-label.col-sm-3.col-form-label.mb-2.fw-bold Priority
                                .col-sm-9
                                  select.form-select(name="priority")
                                    each priority, index in ['low', 'medium', 'high']
                                      option(value=priority selected=(card.priority == priority)) #{priority}
                              button.btn.btn-primary.m-2(type='submit') Save
              div
                div.cards.new_card(data-bs-toggle='modal' role="button" data-bs-target=`#newCard-modal-${column.id}`) Add a card
                .modal.new_card_modal.hide.fade(tabindex='-1' aria-labelledby=`newCard-modal-${column.id}-label` aria-hidden='true' id=`newCard-modal-${column.id}`)
                  .modal-dialog.modal-md
                    .modal-content
                      .modal-header
                        h4.modal-title Add a card to #{column.name}
                        button.btn-close(type='button' data-bs-dismiss='modal')
                      .modal-body
                        form.form-horizontal(name='card-form' method='POST' action='/boards/' + board.id + '/column/'+column.id+'/card')
                          .form-group
                            .row.mb-3
                              label.form-label.col-sm-3.col-form-label.mb-2.fw-bold(for='inputName') Name
                              .col-sm-9
                                input#inputName.form-control(type='text' name='name', required, autocomplete='name')
                            .row.mb-3
                              label.form-label.col-sm-3.col-form-label.mb-2.fw-bold(for='inputDescription') Description
                              .col-sm-9
                                textarea#inputDescription.form-control(name='description' rows='3' autocomplete='description')
                            .row.mb-3
                              label.form-label.col-sm-3.col-form-label.mb-2.fw-bold(for='inputPriority') Priority
                              .col-sm-9
                                select.form-select(name="priority")
                                  each priority, index in ['low', 'medium', 'high']
                                    option(value=priority selected=('low'==priority)) #{priority}
                            .row.mb-3
                              .col-sm-9.offset-sm-3.text-sm-end
                                input.btn.btn-primary.m-2(type='submit' value='Submit')
                                button.btn.btn-default(data-bs-dismiss='modal') Cancel

          div.column.new_column
            p.column_header.new_header(data-bs-toggle='modal' role="button" data-bs-target='#newColumnModal') Add a column

    #newColumnModal.modal.hide.fade(tabindex='-1' aria-labelledby='newColumnModalLabel' aria-hidden='true')
      .modal-dialog.modal-md
        .modal-content
          .modal-header
            h4.modal-title Add a column
            button.btn-close(type='button' data-bs-dismiss='modal')
          .modal-body
            form.form-horizontal(name='column-form' method='post' action='/boards/' + board.id + '/column/')
              .form-group
                .row.mb-3
                  label.col-sm-3.text-sm-end.col-form-label(for='inputName') Name
                  .col-sm-9
                    input#inputName.normal-font-weight(type='text' name='name', required, autocomplete='name')
                .row.mb-3
                  .col-sm-9.offset-sm-3.text-sm-end
                    input.btn.btn-primary(type='submit' value='Submit')
                    button.btn.btn-default(data-bs-dismiss='modal') Cancel

